---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

First, the activity dataset was loaded into R. Before analysis, the 'Date' variable was coerced to POSIXct format, to allow for easier coding.

```{r package_load, include = FALSE}
library(dplyr)
library(data.table)
library(tidyr)
library(ggplot2)
```

```{r preprocessing, results="hide"}
data <- read.csv(unz("activity.zip", "activity.csv"))
data <- mutate(data, date = as.POSIXct(date, tz = "", "%Y-%m-%d"))
```

## What is mean total number of steps taken per day?

Missing values were removed from the dataset for this analysis. With the remaining values, the total number of steps taken per day was calculated.

```{r meansteps}
complete_data <- na.omit(data)
per_day <- tapply(complete_data$steps, complete_data$date, sum)
```

The total number of steps was plotted as a histogram using the ggplot2 graphics system:

```{r histogram}
qplot(per_day, 
      geom = "histogram", 
      binwidth = 5000, 
      main = "Histogram of Total Number of Steps per Day",
      xlab = "Total Number of Steps",
      ylab = "Frequency",
      fill = I("maroon"), col = I("black")) + theme_bw()
```

```{r overalmeansteps, echo = FALSE}
mean <- mean(per_day)   ## 10766.15
median <- median(per_day) ## 10765
```

Overall, the mean number of total steps per day was `r mean`, and the median number of steps was `r median`.

## What is the average daily activity pattern?

First, the mean number of steps per five-minute interval was calculated and formatted as a data frame for graphing.

```{r interval}
by_interval <- tapply(complete_data$steps, complete_data$interval, mean) %>%
  as.data.frame() %>%
  setDT(keep.rownames = TRUE)
names(by_interval) <- c("interval", "steps")
by_interval <- mutate(by_interval, interval = as.numeric(interval))
```

Mean steps was plotted as a function of five-minute interval over the day:

```{r graph}
ggplot(data = by_interval, aes(interval, steps, group = 1)) + geom_line(col = "maroon") +
  labs(title = "Mean Number of Steps per 5-minute Interval", x = "5-Minute Interval",
       y = "Mean Number of Steps") + theme_bw()
```

```{r maxinterval}
max <- max(by_interval$steps)
max_interval <- subset(by_interval, steps == max)
```

Overall, the interval with greatest mean number of steps was interval `r max_interval$interval`.

## Imputing missing values

```{r echo = FALSE}
missing <- sum(is.na(data))
```

In the dataset, there was a total of `r missing` missing values. All missing values were replaced with the mean value for that five-minute-interval using a for loop.

```{r imputemissing}
imputed_data <- data
for(i in 1:length(imputed_data$steps)){
  if(is.na(imputed_data$steps[i])){
    imputed_data$steps[i] <- by_interval[which(by_interval$interval == imputed_data$interval[i]), 2]
  }
}
```

With this imputed dataset, the total number of steps per day was calculated and graphed as a histogram.

```{r imputeanalysis}
imputed_per_day <- tapply(imputed_data$steps, imputed_data$date, sum)
qplot(imputed_per_day, 
      geom = "histogram", 
      binwidth = 5000, 
      main = "Histogram of Total Number of Steps per Day",
      xlab = "Total Number of Steps",
      ylab = "Frequency",
      fill = I("maroon"), col = I("black")) + theme_bw()
```

```{r}
imputed_mean <- mean(imputed_per_day)
imputed_median <- median(imputed_per_day)
```

With this new imputed dataset, the mean number of steps per day was `r imputed_mean`, and the median number of steps was `r imputed_median`.

This imputed data was then compared to the original data using a paneled histogram.
```{r, echo = FALSE}
imputed_per_day <- as.data.frame(imputed_per_day) %>%
  mutate(data = "imputed")
names(imputed_per_day) <- c("steps", "data")
complete_per_day <- as.data.frame(per_day) %>%
  mutate(data = "original")
names(complete_per_day) <- c("steps", "data")
compare <- rbind(imputed_per_day, complete_per_day)

ggplot(compare, aes(x=steps)) + 
  geom_histogram(binwidth = 5000, fill = "maroon", col = "black") +
  facet_grid(.~data) + theme_bw() +
  labs(title = "Total Steps per Day by Dataset", x = "Steps", y = "Count")
```

The two datasets were very similar, however the imputed data set had more values, clustered around the mean. This did not significantly change the mean or median number of steps per day:

```{r, echo = FALSE}
library(xtable)
table <- as.data.frame(matrix(data = c(mean, imputed_mean, median, imputed_median), nrow = 2, dimnames = list(c("Original", "Imputed"), c("Mean", "Median"))))
print(table)
```

## Are there differences in activity patterns between weekdays and weekends?

A new factor variable was created, classifying dates as "Weekend" or "Weekday". This was accomplished using the weekdays() function to assign a day of the week to each date, then a for loop to classify each day of the week as "Weekend" or "Weekday."  

```{r day_type}
imputed_data_2 <- mutate(imputed_data, day = weekdays(date))

for(i in 1:length(imputed_data_2$day)){
  if(imputed_data_2$day[i] %in% c("Saturday", "Sunday")){
  imputed_data_2$day_type[i] = "Weekend"
  }else{
    imputed_data_2$day_type[i] = "Weekday"
  }
}
```

The mean number of steps per five minute interval was calculated, stratifying by the new "Weekend/Weekday" variable. The data was reformatted for easy graphing.  

```{r}
by_day_type <- tapply(imputed_data_2$steps, INDEX = list(imputed_data_2$day_type, 
imputed_data_2$interval), mean)

by_day_type_df <- as.data.frame(by_day_type) %>%
  setDT(keep.rownames = "day_type") %>%
  gather(key = "interval", value = "steps", -day_type) %>%
  mutate(interval = as.numeric(interval))
```

A panel time-series plot was created to compare Weekend and Weekday activity:

```{r panelplot}
ggplot(by_day_type_df, aes(interval, steps, group = 1)) + geom_line(col = "maroon") + 
  facet_grid(day_type ~ .) + theme_bw()
```

Weekend and Weekday activity followed similar broad patterns (i.e., peaks at the same 5-minute intervals). However, on Weekdays there was one very large peak around interval 800, with other peaks much shorter; on Weekends, the peaks were more similar to each other in intensity.


